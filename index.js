!function(e){function t(n){if(a[n])return a[n].exports;var r=a[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){var n=a(3);$(function(){$("#run").bind("click",function(){var e=$("#source").val();window.localStorage.setItem("source",e),n.go(e,$("#result")[0],!0)}),$("#terminate").bind("click",function(){var e=n.terminate(!0);console.log(e)}),$("#source").bind("keydown",function(e){return 9==e.keyCode?($(this).val($(this).val()+"    "),!1):void 0}),$("#source").val(window.localStorage.source||"")})},function(e,t){function a(e,t,a,n){this.type=e,this.value=t,this.row=a,this.col=n}function n(e,t,n,r){h.push(new a(e,t,n,r))}function r(e){h=[];for(var t,a=e.length,r=0,c=1,S=0;;){if(t=e[r++],S++,"\x00"==t||r>=a)break;if(" "!=t)if("\n"==t)c++,S=0;else if("#"==t)for(;"\x00"!=e[r]&&"\n"!=e[r];)r++;else if(t>="A"&&"Z">=t||t>="a"&&"z">=t||"_"==t){var o=e.substring(r-1),p=!1;for(var f in s.slice(0,u))if(new RegExp("^"+s[f]+"(?=[^A-Za-z0-9_])").test(o)){n(l.SYMBOLS,s[f],c,S),r+=s[f].length-1,S+=s[f].length-1,p=!0;break}if(!p)for(var f in i)if(new RegExp("^"+i[f]+"(?=[^A-Za-z0-9_])").test(o)){n(l.VARIABLE,i[f],c,S),r+=i[f].length-1,S+=i[f].length-1,p=!0;break}if(!p){var L=/^[_A-Za-z][A-Za-z0-9_]*/.exec(o);n(l.VARIABLE,L[0],c,S),r+=L[0].length-1,S+=L[0].length-1}}else if(t>="0"&&"9">=t||"."==t){var o=e.substring(r-1),M=/^[\d\.]+/.exec(o);n(l.NUMBER,parseFloat(M[0]),c,S),r+=M[0].length-1,S+=M[0].length-1}else if('"'==t){var o=e.substring(r-1);str_match=/"[^\n]*?[^\\]"/.exec(o),str_match||n(l.ILLEGAL,"error string",c,S),n(l.STRING,str_match[0].slice(1,-1).replace("\\n","\n").replace("\\t","	").replace("\\\\","\\").replace("\\'","'").replace('\\"','"'),c,S),r+=str_match[0].length-1,S+=str_match[0].length-1}else{var o,O;for(var f in s.slice(u))if(O=s[u+parseInt(f)],o=e.substr(r-1,O.length),o==O){n(l.SYMBOLS,O,c,S),r+=O.length-1,S+=O.length-1;break}}}return h}var h=[],s="string else if int return sizeof while void for break continue float double <<= >>= ++ -- || && == != <= >= << >> += -= *= /= &= |= %= + - | & ~ ! ^ ? : ; , * / % ( ) { } [ ] = > <".split(" ");const u=9;var i="print malloc exit rand".split(" ");const l={VARIABLE:0,NUMBER:1,STRING:2,SYMBOLS:3,ILLEGAL:4};a.prototype.match=function(e,t){return e==l.SYMBOLS?Array.isArray(t)?-1!=t.indexOf(this.value):this.type==e&&this.value==t:this.type==e},e.exports={tokenizer:r,TYPE:l,FUNCS:i,KEYS:s}},function(e,t){function a(e){return p.value+=e,/exit\(.*\)/.test(e)&&(p.scrollTop=p.scrollHeight),1}function n(e){if(0>=e)return 0;for(var t in e)l.push(0);return l.length}function r(){a("exit("+l[v]+")\n"),c=0,window.clearInterval(S)}function h(e,t){f.postMessage({cmd:"init",CMD:B,ds_size:e,ss_size:t})}function s(e,t,n){t=t||512,n=n||512,l=new Array(t+n),p=e,window.Worker?(f=new window.Worker("thread.js"),f.onmessage=function(e){var t=e.data;switch(t.cmd){case"print":a(t.data);break;case"core_dump":console.log(t.data)}}):alert("你的浏览器不资瓷Worker,只能用setTimeout了"),f&&h(t,n)}function u(){O=i[M++],o++,O==B.IMM?L=i[M++]:O==B.LC?L=String(l[L]):O==B.LI?L=parseInt(l[L]):O==B.LD?L=parseFloat(l[L]):O==B.SC?l[l[v++]]=String(L):O==B.SI?l[l[v++]]=parseInt(L):O==B.SD?l[l[v++]]=parseFloat(L):O==B.POPC?L=String(l[v++]):O==B.POPI?L=parseInt(l[v++]):O==B.POPD?L=parseFloat(l[v++]):O==B.PUSH?l[--v]=L:O==B.JMP?M=i[M]:O==B.JNZ?M=L?i[M]:M+1:O==B.JZ?M=L?M+1:i[M]:O==B.CALL?(l[--v]=M+1,M=i[M]):O==B.ENT?(l[--v]=m,m=v,v-=i[M++]):O==B.LEV?(v=m,m=l[v++],M=l[v++]):O==B.ADJ?v+=i[M++]:O==B.LEA?L=m+i[M++]:O==B.OR?L=l[v++]|L:O==B.AND?L=l[v++]&L:O==B.XOR?L=l[v++]^L:O==B.EQ?L=l[v++]===L?1:0:O==B.NE?L=l[v++]!==L?1:0:O==B.GT?L=l[v++]>L?1:0:O==B.GE?L=l[v++]>=L?1:0:O==B.LT?L=l[v++]<L?1:0:O==B.LE?L=l[v++]<=L?1:0:O==B.SHL?L=l[v++]<<L:O==B.SHR?L=l[v++]>>L:O==B.ADD?L=l[v++]+L:O==B.SUB?L=l[v++]-L:O==B.MUL?L=l[v++]*L:O==B.DIV?L=l[v++]/L:O==B.MOD?L=l[v++]%L:O==B.PRIT?L=a(l[v]):O==B.MALC?L=n(l[v]):O==B.EXIT&&r()}var i,l,c,S,o,p,f,L,M,O,v,m;const B={IMM:0,LC:1,LI:2,LD:3,SC:4,SI:5,SD:6,PUSH:7,POPI:8,POPC:9,POPD:10,JMP:11,JNZ:12,JZ:13,CALL:14,ENT:15,ADJ:16,LEV:17,LEA:18,OR:19,AND:20,XOR:21,EQ:22,NE:23,GT:24,GE:25,LT:26,LE:27,SHL:28,SHR:29,ADD:30,SUB:31,MUL:32,DIV:33,MOD:34,PRIT:35,EXIT:36,MALC:37},d=[2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];s.prototype.run=function(e){if(f)return void f.postMessage({cmd:"run",asm:e});if(c)return!1;i=e.code;for(var t in e.data)l[t]=e.data[t];return m=v=l.length,M=e.start_addr,o=0,c=1,this.eval()},s.prototype.terminate=function(e){return f?(f.terminate(),delete f,a("aborted!\n"),!0):c?(c=0,window.clearInterval(S),e?(a("aborted!"),{code:i,memory:l,ip:M,sp:v,bp:m,cycle:o}):!0):!1},s.prototype.eval=function(){return S=window.setInterval(u,0),!0},e.exports={vm:s,CMD:B,CMD_BYTE:d}},function(e,t,a){function n(e){var t={};for(var a in e)!t.hasOwnProperty(e[a])&&e.hasOwnProperty(a)&&(t[e[a]]=a);return t}function r(e,t,a){var r=e+"\x00",h=i.tokenizer(r);a&&(console.info("TOKEN LIST"),h.forEach(function(e){console.log(e.value)}));var c;try{c=l.parse(h)}catch(S){return t.value+=S+"\n",-1}if(a){var o,p=n(u.CMD);console.info("ASM CODE");for(var f=0;f<c.code.length;f++)o=f+"	",o+=" | "+p[c.code[f]]||"UNKNOWN!",2==u.CMD_BYTE[c.code[f]]&&(o+=" "+c.code[++f]),console.log(o)}return s=new u.vm(t),s.run(c)}function h(e){return s?s.terminate(e):!1}var s,u=a(2),i=a(1),l=a(4);e.exports={array_flip:n,go:r,terminate:h}},function(e,t,a){function n(e){return e%3==w.STRING}function r(e){return e%3==w.INT}function h(e){return e>=3}function s(e){r(e)||h(e)?C.push(E.SI):n(e)?C.push(E.SC):C.push(E.SD)}function u(e){r(e)||h(e)?C.push(E.LI):n(e)?C.push(E.LC):C.push(E.LD)}function i(e){r(e)||h(e)?C.push(E.POPI):n(e)?C.push(E.POPC):C.push(E.POPD)}function l(){N=R.shift()}function c(){var e=w.INT;for(N.match(A.SYMBOLS,"int")?e=w.INT:N.match(A.SYMBOLS,"string")?e=w.STRING:N.match(A.SYMBOLS,["double","float"])?e=w.DOUBLE:P("error to get type of variable"),l();N.match(A.SYMBOLS,"*");)e+=w.PTR,l();return e}function S(){for(var e=c();!N.match(A.SYMBOLS,";");)N.match(A.VARIABLE)||P("bad global declaration"),-1!=Object.keys(U).indexOf(N.value)&&P("duplicate variable declaration"),U[N.value]={var_addr:H.length,var_type:e},H.push(0),l(),N.match(A.SYMBOLS,"=")&&(l(),N.match(A.NUMBER)||N.match(A.STRING)?h(e)||r(e)?H[H.length-1]=parseInt(N.value):H[H.length-1]=N.value:P("非法赋值!"),l()),N.match(A.SYMBOLS,",")&&l();l()}function o(){var e=c();N.match(A.VARIABLE)||P("bad global function declaration"),-1!=Object.keys(b).indexOf(N.value)&&P("duplicate variable declaration"),b[N.value]={var_addr:C.length,var_type:e},l(),N.match(A.SYMBOLS,"(")?l():P(),p(),N.match(A.SYMBOLS,")")?l():P(),N.match(A.SYMBOLS,"{")?l():P(),f(),N.match(A.SYMBOLS,"}")?l():P()}function p(){for(;!N.match(A.SYMBOLS,")");){var e=c();N.match(A.VARIABLE)||P("bad function param declaration"),-1!=Object.keys(x).indexOf(N.value)&&P("duplicate local variable declaration"),x[N.value]={var_addr:_++,var_type:e},l(),N.match(A.SYMBOLS,",")&&l()}_++}function f(){var e=_;C.push(E.ENT);var t=C.length;for(C.push("?");N.match(A.SYMBOLS,["string","int","double","float"]);){var a=w.INT;for(a=N.match(A.SYMBOLS,"int")?w.INT:N.match(A.SYMBOLS,"string")?w.STRING:w.DOUBLE,l();!N.match(A.SYMBOLS,";");){for(var n=a;N.match(A.SYMBOLS,"*");)n+=w.PTR,l();N.match(A.VARIABLE)||P("bad local declaration"),-1!=Object.keys(x).indexOf(N.value)&&P("duplicate local variable declaration"),x[N.value]={var_addr:++e,var_type:n},l(),N.match(A.SYMBOLS,"=")&&(l(),C.push(E.LEA),C.push(_-e),C.push(E.PUSH),B(d("=")),s(n)),N.match(A.SYMBOLS,",")&&l()}l()}for(C[t]=e-_;!N.match(A.SYMBOLS,"}");)L();C.push(E.LEV),x={}}function L(){if(N.match(A.SYMBOLS,"if"))l(),M();else if(N.match(A.SYMBOLS,"while"))l(),O();else if(N.match(A.SYMBOLS,"for"))l(),v();else if(N.match(A.SYMBOLS,"return"))l(),m();else if(N.match(A.SYMBOLS,["break","continue"]))C.push(E.JMP),C.push(N.value),l(),N.match(A.SYMBOLS,";")?l():P();else if(N.match(A.SYMBOLS,"{")){for(l();!N.match(A.SYMBOLS,"}");)L();l()}else N.match(A.SYMBOLS,";")?l():(B(0),N.match(A.SYMBOLS,";")?l():P())}function M(){N.match(A.SYMBOLS,"(")?l():P(),B(0),N.match(A.SYMBOLS,")")?l():P(),C.push(E.JZ);var e=C.length;if(C.push(0),L(),N.match(A.SYMBOLS,"else")){l(),C.push(E.JMP);var t=C.length;C.push(0),C[e]=C.length,L(),C[t]=C.length}else C[e]=C.length}function O(){var e=C.length;N.match(A.SYMBOLS,"(")?l():P(),B(d("=")),N.match(A.SYMBOLS,")")?l():P(),C.push(E.JZ);var t=C.length;C.push("?"),L(),C.push(E.JMP),C.push(e),C[t]=C.length;for(var a=t;a<C.length;a++)"break"==C[a]?C[a]=C.length:"continue"==C[a]&&(C[a]=e)}function v(){N.match(A.SYMBOLS,"(")?l():P(),B(d("=")),N.match(A.SYMBOLS,";")?l():P();var e=C.length;B(d("=")),C.push(E.JZ);var t=C.length;C.push("?"),C.push(E.JMP);var a=C.length;C.push("?"),N.match(A.SYMBOLS,";")?l():P();var n=C.length;B(d("=")),C.push(E.JMP),C.push(e),N.match(A.SYMBOLS,")")?l():P();var r=C.length;L(),C.push(E.JMP),C.push(n);var h=C.length;C[t]=h,C[a]=r;for(var s=r;h>s;s++)"break"==C[s]?C[s]=h:"continue"==C[s]&&(C[s]=n)}function m(){N.match(A.SYMBOLS,";")||B(d("=")),N.match(A.SYMBOLS,";")?l():P(),C.push(E.LEV)}function B(e){if(!N||N.match(A.ILLEGAL))P("非法字符!");else if(N.match(A.NUMBER))C.push(E.IMM),C.push(N.value),k=w.DOUBLE,l();else if(N.match(A.STRING)){var t=H.length;H.push(N.value),C.push(E.IMM),C.push(t),C.push(E.LC),k=w.STRING,l()}else if(N.match(A.SYMBOLS,"sizeof"))l(),N.match(A.SYMBOLS,"(")?l():P(),N.match(A.NUMBER)||N.match(A.STRING)?l():P(),N.match(A.SYMBOLS,")")?l():P(),C.push(E.IMM),C.push(1),k=w.INT;else if(N.match(A.VARIABLE))if(-1!=Object.keys(U).indexOf(N.value))C.push(E.IMM),C.push(U[N.value].var_addr),k=U[N.value].var_type,u(k),l();else if(-1!=Object.keys(x).indexOf(N.value))C.push(E.LEA),C.push(_-x[N.value].var_addr),k=x[N.value].var_type,u(k),l();else if(-1!=Object.keys(b).indexOf(N.value)||-1!=D.FUNCS.indexOf(N.value)){var a=N.value;l(),N.match(A.SYMBOLS,"(")?l():P();for(var n=0;!N.match(A.SYMBOLS,")");)B(0),C.push(E.PUSH),n++,N.match(A.SYMBOLS,",")&&l();if(l(),-1!=Object.keys(b).indexOf(a))C.push(E.CALL),C.push(b[a].var_addr),k=b[a].var_type;else{var r={print:E.PRIT,malloc:E.MALC,exit:E.EXIT};C.push(r[a])}C.push(E.ADJ),C.push(n)}else P();else if(N.match(A.SYMBOLS,"("))if(l(),N.match(A.SYMBOLS,["int","string","float","double"])){var h=c();N.match(A.SYMBOLS,")")?l():P(),B(d("++")),C.push(E.PUSH),i(h),k=h}else B(0),N.match(A.SYMBOLS,")")?l():P();else if(N.match(A.SYMBOLS,"*"))l(),B(d("single")),k>=w.PTR&&(k-=w.PTR),u(k);else if(N.match(A.SYMBOLS,"&"))l(),B(d("single")),-1!=[E.LI,E.LC,E.LD].indexOf(C[C.length-1])?C.pop():P(),k+=w.PTR;else if(N.match(A.SYMBOLS,"!"))l(),B(d("single")),C.push(E.PUSH),C.push(E.IMM),C.push(0),C.push(E.EQ),k=w.INT;else if(N.match(A.SYMBOLS,"~"))l(),B(d("single")),C.push(E.PUSH),C.push(E.IMM),C.push(255),C.push(E.XOR),k=w.INT;else if(N.match(A.SYMBOLS,"+"))l(),B(0),k=w.INT;else if(N.match(A.SYMBOLS,"-"))l(),C.push(E.IMM),C.push(-1),C.push(E.PUSH),B(d("single")),C.push(E.MUL),k=w.INT;else if(N.match(A.SYMBOLS,"++")){l(),B(d("single"));var S=C[C.length-1];-1==[E.LI,E.LC,E.LD].indexOf(S)?P("++前必须是变量"):(C[C.length-1]=E.PUSH,C.push(S)),C.push(E.PUSH),C.push(E.IMM),C.push(1),C.push(E.ADD),s(k),k=w.INT}else if(N.match(A.SYMBOLS,"--")){l(),B(d("single"));var S=C[C.length-1];-1==[E.LI,E.LC,E.LD].indexOf(S)?P("--前必须是变量"):(C[C.length-1]=E.PUSH,C.push(S)),C.push(E.PUSH),C.push(E.IMM),C.push(1),C.push(E.SUB),s(k),k=w.INT}else P();for(var o=k;d(N.value)>=e;)if(N.match(A.SYMBOLS,"="))l(),-1!=[E.LI,E.LC].indexOf(C[C.length-1])?C[C.length-1]=E.PUSH:P(),B(d("=")),k=o,s(k);else if(N.match(A.SYMBOLS,["+=","-=","*=","/=","&=","|=","%=","<<=",">>="])){var S={"+=":E.ADD,"-=":E.SUB,"*=":E.MUL,"/=":E.DIV,"&=":E.AND,"|=":E.OR,"%=":E.MOD,"<<=":E.SHL,">>=":E.SHR},p=S[N.value];l(),-1!=[E.LI,E.LC].indexOf(C[C.length-1])?(C[C.length-1]=E.PUSH,C.push(E.LI),C.push(E.PUSH)):P(),B(d("=")),k!=o&&P("运算符两侧变量类型不同!"),C.push(p),s(k)}else if(N.match(A.SYMBOLS,"?")){l(),C.push(E.JZ);var f=C.length;C.push(0),B(d("=")),C.push(E.JMP);var L=C.length;C.push(0),match(A.SYMBOLS,":")?l():P(),C[f]=C.length,B(d("?")),C[L]=C.length,k=w.INT}else if(N.match(A.SYMBOLS,"||")){l(),C.push(E.JNZ);var f=C.length;C.push(0),B(d("||")),C[f]=C.length,k=w.INT}else if(N.match(A.SYMBOLS,"&&")){l(),C.push(E.JZ);var f=C.length;C.push(0),B(d("&&")),C[f]=C.length,k=w.INT}else if(N.match(A.SYMBOLS,["|","&","^","+","-","*","/","%","==","!=","<=",">=","<<",">>","<",">"])){var S={"|":E.OR,"&":E.ADD,"^":E.XOR,"+":E.ADD,"-":E.SUB,"*":E.MUL,"/":E.DIV,"%":E.MOD,"==":E.EQ,"!=":E.NE,">=":E.GE,"<=":E.LE,">":E.GT,"<":E.LT,"<<":E.SHL,">>":E.SHR},p=S[N.value],M=d(N.value);l(),C.push(E.PUSH),B(M),C.push(p),k=w.INT}else if(N.match(A.SYMBOLS,"++")){l();var S=C[C.length-1];-1==[E.LI,E.LC,E.LD].indexOf(S)?P("++前必须是变量"):(C[C.length-1]=E.PUSH,C.push(S)),C.push(E.PUSH),C.push(E.IMM),C.push(1),C.push(E.ADD),s(k),C.push(E.PUSH),C.push(E.IMM),C.push(1),C.push(E.SUB),k=w.INT}else if(N.match(A.SYMBOLS,"--")){l();var S=C[C.length-1];-1==[E.LI,E.LC,E.LD].indexOf(S)?P("++前必须是变量"):(C[C.length-1]=E.PUSH,C.push(S)),C.push(E.PUSH),C.push(E.IMM),C.push(1),C.push(E.SUB),s(k),C.push(E.PUSH),C.push(E.IMM),C.push(1),C.push(E.ADD),k=w.INT}else if(N.match(A.SYMBOLS,"["))l(),k<w.PTR&&P(),C.push(E.PUSH),B(0),N.match(A.SYMBOLS,"]")?l():P(),C.push(E.ADD),u(k),k-=o-w.PTR;else{if(N.match(A.SYMBOLS,";")||N.match(A.SYMBOLS,")")||N.match(A.SYMBOLS,"]")||N.match(A.SYMBOLS,":")||N.match(A.SYMBOLS,"?")||N.match(A.SYMBOLS,","))break;P()}}function d(e){return"="==e?0:"?"==e?1:"||"==e?2:"&&"==e?3:"|"==e?4:"&"==e?5:-1!=["==","!="].indexOf(e)?6:-1!=[">",">=","<","<="].indexOf(e)?7:-1!=["+","-"].indexOf(e)?8:-1!=["*","/","%"].indexOf(e)?9:"single"==e?10:"["==e?11:0}function g(){for(var e in R){if(R[e].match(A.SYMBOLS,"("))return o();if(R[e].match(A.SYMBOLS,";"))return S()}console.log("error: illegal token! "+JSON.stringify(N)),P()}function I(e){for(Y(),R=e,l();N;)g();b.hasOwnProperty("main")||P("lack of main function");var t=C.length;return C.push(E.CALL),C.push(b.main.var_addr),C.push(E.PUSH),C.push(E.EXIT),y={code:C,data:H,start_addr:t}}function Y(){R=[],U={},b={},x={},C=[],H=[],_=0}function P(e){var t="row: "+N.row+" col: "+N.col+" parse error ";throw e||t}var T=a(2),D=a(1);const E=T.CMD,A=D.TYPE;var N,R=[],U={},b={},x={},y={},C=[],H=[],_=0;const w={VOID:-1,INT:0,DOUBLE:1,STRING:2,PTR:3};var k;e.exports={parse:I}}]);